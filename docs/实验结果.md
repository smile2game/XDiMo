# XDiMo 训练实验结果

模型: **Latte-S/2**（75.14M 参数），数据集: **FFS** 704 videos，配置见 `configs/ffs/`。

单节点 4 卡对比：**6000ada** 8 张卡可并行 2 个任务；**H200 仅 5 张卡**、**pro6000 有 1 张被占**，各同时只能跑 1 个 4 卡任务。提交前先 `jhosts`，最大等待任务数 1，建议用 `submit_first_batch.sh` + `submit_remaining.sh` 分批提交。

---

## 结果汇总表（4 卡）

| 硬件 | 模型参数 | 显存占用 | 硬件浮点峰值(FP16) | token/样本吞吐量 | MFU(浮点利用率) | 加速比 |
|------|----------|----------|---------------------|------------------|-----------------|--------|
| gpu_6000ada | 75.14M | 待填 | 91.1 TFLOPs/卡 | 待填 | 待填 | 1.0(基准) |
| gpu_h200 | 75.14M | 待填 | 989 TFLOPs/卡 | 待填 | 待填 | 待填 |
| gpu_pro6000 | 75.14M | 待填 | 200 TFLOPs/卡 | 待填 | 待填 | 待填 |

- **token/样本吞吐量**：steps/s × global_batch（samples/s）；若有 token 统计可填 token/s。
- **加速比**：以 6000ada baseline 为 1.0。
- **MFU**：见 `docs/mfu.md`，MFU = 实际达到的 TFLOPs / (GPU数 × 单卡峰值 TFLOPs)。

---

## 达到结果的方法（简明）

1. **CPU 核数**：`-n = 卡数*8`（如 4 卡用 `-n 32`），过高会导致 CPU 资源不足、任务无法启动。
2. **MFU 优化**：增大 `local_batch_size` 提高利用率；H200 80GB 用 bs=4，6000ada/pro6000 48GB 用 bs=2；配置见 `configs/ffs/ffs_train_4gpu_bs{1,2,4}.yaml`。
3. **GPU 峰值**：`train.py` 中 `_GPU_PEAK_TFLOPS_FP16` 需与真实硬件一致，否则 MFU 会偏大或偏小。
4. **提交方式**：提交前先 `jhosts`。建议分批：`submit_first_batch.sh`（4 个）→ 有空位再 `submit_remaining.sh`（2 个）；或一次 `submit_compare.sh`（6 个，注意 PEND 上限 1）。查看 `jjobs`，杀任务 `jctrl kill <id>`。

---

## 脚本与配置

| 目录 | 内容 |
|------|------|
| `scripts/4gpu/6000ada/` | 6000ada：baseline.sh(bs1)、bs2.sh(bs2) |
| `scripts/4gpu/pro6000/` | pro6000：baseline.sh(bs1)、bs2.sh(bs2) |
| `scripts/4gpu/h200/` | H200：baseline.sh(bs1)、bs4.sh(bs4) |
| `scripts/4gpu/submit_compare.sh` | 一次提交 6 个（注意 PEND 上限 1） |
| `scripts/4gpu/submit_first_batch.sh` | 建议先提交 4 个（2×6000ada + 1×h200 + 1×pro6000） |
| `scripts/4gpu/submit_remaining.sh` | 有空位时再提交剩余 2 个 |

单独提交示例：`cd XDiMo && jsub < scripts/4gpu/6000ada/baseline.sh`。

---

## 历史实验（参考）

| 硬件 | GPU数 | global_batch | Steps/s | Achieved TFLOPs/s | MFU | 备注 |
|------|-------|--------------|---------|-------------------|-----|------|
| 6000ada | 8 | 8 | ~3.5 | ~235 | **~32%** | 修正峰值 91.1 |
| H200 | 2 | 2 | ~5.1 | ~86 | ~4.3% | batch 过小，算力喂不饱 |

新跑完 4 卡实验后，把上表「结果汇总表」和本段历史数据按实际日志更新即可。
