# pytorch.ddp

算力对比：

| 显卡     | fp16 算力(cuda/tensor) TFLOPs/s | fp32 |
| -------- | ------------------------------- | ---- |
| 4090     | 82.6 /  330.3                   | 82.6 |
| A6000ada | - (推测能到 )                   | -    |
| H100     | -                               | -    |

训练过程中的前向传播主要通过tensor core来计算，用fp16算力 

## Latte-L(457MB)

Latte-L模型规模是 457MB，数据集采用ffs包含 704个videos

单节点八卡加速比是 3.98，但是双节点直接翻倍，这里应该是有点问题的，按理说应该IB之间会有通信瓶颈吧

多节点会比单节点多出来一点点显存

| 卡数           | 单卡显存<br/>GB | local_<br/>batch_size | global_<br/>batch_size                  | num<br/>_workers | 速度<br/>iter/s | 数据<br/>速度 <br/>data/s | 提升<br/>倍数 | 收敛<br/>耗时 |
| -------------- | --------------- | --------------------- | --------------------------------------- | ---------------- | --------------- | ------------------------- | ------------- | ------------- |
| 1 x 1 4090     | 18.9G           | 1                     | 1                                       |                  | 3.05            | 3.05                      | 1             |               |
| 1 x 8 4090     | 18.9G           | 1                     | 8                                       |                  | 1.52            | 12.16                     | 3.98          |               |
| 2 x 8 4090     | 18.9            | 1                     | 16                                      |                  | 1.52            | 24.32                     | 7.97          |               |
| 2 x 8 4090     |                 | 2                     | 32                                      |                  |                 |                           |               |               |
|                |                 |                       |                                         |                  |                 |                           |               |               |
| 1 x 1 a6000ada |                 | 1                     | 1                                       | 8                | 3.22            | 3.22                      | 1.05(环比)    |               |
| 1 x 1 a6000ada |                 | 1                     | 1                                       | 16               | 3.22            | 3.22                      | 1.05          |               |
| 1 x 8 a6000ada | 18.9            | 1                     | 8                                       | 16               | 2.33            | 18.64                     | 5.78(同比)    |               |
| 2 x 8 a6000ada | 19.0            | 1                     | 16                                      |                  | 2.22            | 35.52                     | 11.03(同比)   |               |
| 2 x 8 a6000ada | 27.65           | 2                     | 32<br/><br/>704/32 = 22<br/>steps/epoch |                  | 0.81            | 25.92                     |               |               |
| 2 x 8 a6000ada |                 | 4                     | 64                                      |                  |                 |                           |               |               |
| 3 x 8 a6000ada |                 | 1                     | 24                                      |                  |                 |                           |               |               |
| 3 x 8 a6000ada |                 | 2                     | 48                                      |                  |                 |                           |               |               |
|                |                 |                       |                                         |                  |                 |                           |               |               |
| 1 x 1 H100     |                 | 1                     | 1                                       |                  | 6.10            |                           | 2             |               |
|                |                 |                       |                                         |                  |                 |                           |               |               |





## Latte-XL(673MB):

Latte-XL模型规模是 673MB，数据集采用ffs包含 704个videos

a6000ada的local_batch_size上限是2，4090无法单卡容纳 Latte-XL

| 卡数           | 单卡显存 | local_<br/>batch_size | global_<br/>batch_size | 速度<br/>iter/s | 数据  速度<br/>data/s | 收敛<br/>耗时 |
| -------------- | -------- | --------------------- | ---------------------- | --------------- | --------------------- | ------------- |
| 1 x 1 a6000ada |          | 2                     | 2                      |                 |                       |               |
| 1 x 8 a6000ada |          | 2                     | 16                     | 0.83            | 13.28                 |               |
| 2 x 8 a6000ada |          | 2                     | 32                     |                 |                       |               |
| 3 x 8 a6000ada |          | 2                     | 48                     |                 |                       |               |
| 4 x 8 a6000ada | 37.79    | 2                     | 64                     | 0.51            | 32.64                 |               |



# DeepSpeed

