# XDiMo 训练实验结果

数据集：**FFS** 704 videos。配置见 `configs/ffs/`。

当前有两类对比实验：**① 单卡到多卡的并行加速比**（变量：卡数、并行方式）；**② 模型尺寸与结构的 scaling**（变量：模型代号与 MoE 配置）。下表为实验表格设计，确认后再做代码与实验。

---

## 表一：单卡到多卡加速比实验（变量：卡数 + 并行方式）

**固定模型**：采用 **Latte-L/2-MoE** 与同一训练配置（如 F16S3、256²、相同 batch 设置），仅改变卡数与并行方式。

**衡量方式**：采用「**迭代相同数据量的加速比**」—— 固定**总样本数**，按 Samples/s 计算：加速比 = (多卡 Samples/s) ÷ (单卡 Samples/s)。只有在 global_batch 一致时，才可退化为 Steps/s 或固定 10k steps 耗时比。

以下三张表分别对应硬件 **6000ada**、**H200**、**pro6000**，表头一致。

### 表一-A：6000ada 

| 模型 | 卡数 | 并行方式 | Steps/s | Samples/s | MFU | 完成 10k steps 耗时(s) | 加速比(按Samples/s) | 理想加速比 | 并行效率(%) |
|------|------|----------|---------|-----------|-----|------------------------|-----------------|------------|-------------|
| Latte-L/2-MoE | 1×6000ada | 单卡 | 1.46 | 1.46 | 87.5% | 6849 | 1.0(基准) | 1 | 100% |
| Latte-L/2-MoE | 2×6000ada | DDP 单机 | 1.25 | 2.50 | 74.5% | 8000 | 1.71 | 2 | 85.6% |
| Latte-L/2-MoE | 4×6000ada | DDP 单机 | 1.15 | 4.60 | 68.5% | 8696 | 3.15 | 4 | 78.8% |
| Latte-L/2-MoE | 8×6000ada | DDP 单机 | 待填 | 待填 | 待填 | 待填 | 待填 | 8 | 待填 |

### 表一-B：H200

| 模型 | 卡数 | 并行方式 | Steps/s | Samples/s | MFU | 完成 10k steps 耗时(s) | 加速比(按Samples/s) | 理想加速比 | 并行效率(%) |
|------|------|----------|---------|-----------|-----|------------------------|-----------------|------------|-------------|
| Latte-L/2-MoE | 1×H200 | 单卡 | 待填 | 待填 | 待填 | 待填 | 1.0(基准) | 1 | 100% |
| Latte-L/2-MoE | 2×H200 | DDP 单机 | 待填 | 待填 | 待填 | 待填 | 待填 | 2 | 待填 |
| Latte-L/2-MoE | 4×H200 | DDP 单机 | 1.90 | 7.60 | 10.5% | 5263 | 待填(缺1卡基准) | 4 | 待填 |

### 表一-C：pro6000

| 模型 | 卡数 | 并行方式 | Steps/s | Samples/s | MFU | 完成 10k steps 耗时(s) | 加速比(按Samples/s) | 理想加速比 | 并行效率(%) |
|------|------|----------|---------|-----------|-----|------------------------|-----------------|------------|-------------|
| Latte-L/2-MoE | 1×pro6000 | 单卡 | 待填 | 待填 | 待填 | 待填 | 1.0(基准) | 1 | 100% |
| Latte-L/2-MoE | 2×pro6000 | DDP 单机 | 待填 | 待填 | 待填 | 待填 | 待填 | 2 | 待填 |
| Latte-L/2-MoE | 4×pro6000 | DDP 单机 | 待填 | 待填 | 待填 | 待填 | 待填 | 4 | 待填 |

**表头说明：**

- **模型**：本实验固定为 Latte-L/2-MoE。
- **卡数**：格式为「卡数×硬件」，如 1×6000ada、4×H200，便于区分硬件。
- **并行方式**：如单卡、DDP 单机等。
- **Steps/s、Samples/s、MFU**：该配置下稳定训练时的吞吐与浮点利用率。
- **完成 10k steps 耗时(s)**：固定训练步数 10k 的耗时（用于参考吞吐，不等价于相同数据量）。
- **加速比(按Samples/s)**：以“**固定样本量**”为准：同硬件单卡完成相同总样本数的耗时 ÷ 本配置完成相同总样本数的耗时。
- **理想加速比**：= 卡数。
- **并行效率(%)**：= 实际加速比 ÷ 理想加速比 × 100%。

**表下说明：**

> **加速比定义**：本表采用「**迭代相同数据量**」的加速比（固定**总样本数**），而非固定步数。  
> 设单卡 global_batch 为 `B1`，多卡 global_batch 为 `Bn`，需要比较完成相同总样本数 `S` 的耗时：  
> `T1 = S / (B1 × Steps/s_1)`，`Tn = S / (Bn × Steps/s_n)`，加速比 = `T1 / Tn`。  
> 等价地：**加速比 = (Bn × Steps/s_n) / (B1 × Steps/s_1)**，即按 Samples/s 比。  
> 只有在 **global_batch 一致** 时，才可简化为 `Steps/s` 的比值或固定 10k steps 的耗时比。

---

## 表二：不同模型结构与规模（变量：模型尺寸 + MoE 配置）

**变量**：模型代号（S/2、B/2、L/2、XL/2）及 L/2、XL/2 下的三种结构（无 MoE、4E2A、2E1A）。  
**固定**：同一数据集（FFS）、同一卡数/硬件下的训练与评估设置，便于横向比 MFU、速度、收敛与生成质量。

| 模型代号 | 结构/配置 | 具体参数(参数量与关键结构) | MFU | Steps/Sec | 收敛步数 | FFS FVD |
|----------|------------|----------------------------|-----|-----------|----------|---------|
| S/2 | - | 75.14M；depth=12, hidden=384, heads=6, patch=2；无MoE | 待填 | 待填 | 待填 | 待填 |
| B/2 | - | 待填；depth=12, hidden=768, heads=12, patch=2；无MoE | 待填 | 待填 | 待填 | 待填 |
| L/2 | 无MoE | 待填；depth=24, hidden=1024, heads=16, patch=2；无MoE | 待填 | 待填 | 待填 | 待填 |
| L/2 | 4E2A | 待填；depth=24, hidden=1024；4 experts, top_k=2 | 待填 | 待填 | 待填 | 待填 |
| L/2 | 2E1A | 待填；depth=24, hidden=1024；2 experts, top_k=1 | 待填 | 待填 | 待填 | 待填 |
| XL/2 | 无MoE | 待填；depth=28, hidden=1152, heads=16, patch=2；无MoE | 待填 | 待填 | 待填 | 待填 |
| XL/2 | 4E2A | 待填；depth=28, hidden=1152；4 experts, top_k=2 | 待填 | 待填 | 待填 | 待填 |
| XL/2 | 2E1A | 待填；depth=28, hidden=1152；2 experts, top_k=1 | 待填 | 待填 | 待填 | 待填 |

**表头说明：**

- **模型代号**：S/2、B/2、L/2、XL/2（与代码中 Latte-S/2 等对应）。
- **结构/配置**：L/2、XL/2 下区分「无MoE」「4E2A」「2E1A」；S/2、B/2 仅一行，无 MoE 变体。
- **具体参数**：参数量(M) + depth、hidden_size、num_heads、patch_size；若为 MoE，补充 num_experts、top_k。
- **MFU**：该模型在该配置下的浮点利用率。
- **Steps/Sec**：固定卡数/硬件下的训练步速。
- **收敛步数**：在 FFS 上达到你定义的收敛条件（如 loss 阈值或验证指标）所需的训练步数。
- **FFS FVD**：该模型在 FFS 上的 FVD（Fréchet Video Distance），评估生成效果。

**行与变量对应关系：**

1. **S/2**：1 行（无 MoE）。
2. **B/2**：1 行（无 MoE）。
3. **L/2**：3 行 —— 无MoE、4E2A、2E1A。
4. **XL/2**：3 行 —— 无MoE、4E2A、2E1A。

---

## 两类实验的关系（不涉及并行方法优化）

- **表一**：固定模型 **Latte-L/2-MoE**，按硬件拆成三张表（6000ada、H200、pro6000），变量为**卡数 + 并行方式**，回答「同一模型、迭代相同数据量时，多卡相对单卡能快多少」；卡数列格式为 1×6000ada 等，并含 MFU。
- **表二**：变量为**模型尺寸与结构**（S/2、B/2、L/2 三种配置、XL/2 三种配置），在相同卡数/硬件下比较 MFU、Steps/Sec、收敛步数、FFS FVD。

当前不引入「并行方法优化」（如不同通信库、梯度压缩等）的对比，仅用现有 DDP 等并行方式填表一；表二不比较并行方式，只比较模型本身。

确认表格与说明无误后，再据此做实验配置与代码修改（如增加 1 卡/2 卡/8 卡脚本、L·XL 无MoE/4E2A/2E1A 的 config 与注册等）。
